---
title: "Математична статистика. _Лабораторна робота № 4_. Перевірка статистичних гіпотез щодо закону розподілу. Перевірка на нормальність"
author: "Andrii Sydorenko KN23-1"
date: "`r Sys.Date()`"
output:
#   pdf_document:
#     highlight: tango
#     toc: yes
  html_notebook:
    # citation_package: natbib
    toc: yes # Оглавление
    toc_float: true
    highlight: tango # Цвет подсветки кода
fontsize: 12pt # размер шрифта
header-includes:
 \usepackage[T2A]{fontenc}
 \usepackage[utf8]{inputenc}
 \usepackage[russian]{babel}
editor_options: 
  chunk_output_type: console
bibliography: references_lab.bib
---


__Мета:__ _засвоїти ідею методики перевірки статистичних гіпотез щодо закону розподілу випадкової величини засобами мови програмування R; набути навичок роботи у середовищі RStudio із застосуванням концепції "грамотного програмування" із застосуванням пакету R Markdown_. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE}
NeedPackages <- c("lattice", "nortest", "goftest", "dgof","latex2exp")
# install.packages("NeedPackages")
lapply(NeedPackages, library, character.only = TRUE)

# nortest #Проверка на нормальность
# goftest #Подгонка непрерывных распределений
# dgof    #Подгонка дискретных распределений 
# DAAG    #Анализ данных и графики
# latex2exp #Вывод формул на график в формате TeX
```



# Приклад виконання лабораторної роботи

### 1. Постановка задачі{#task}

Випадкова величина  $X$  має заданий закон розподілу, вектор параметрів якого відомий. Згенерувати згідно з варіантом вибірку випадкової величини $X=(x_1,...,x_n)$: спочатку об’єму  $n=50$, що має заданий розподіл, обчислити оцінку вектора параметрів розподілу. 
Висунити і перевірити статистичну гіпотезу щодо нормального закону розподілу величини $X$:  
$H_0: f(x) \in \{ N(x, \mu, \sigma^2), \mu \in \mu, \; \sigma^2 \in  \Sigma^2 \}$  
$H_1: f(x) \notin \{ N(x, \mu, \sigma^2), \mu \in \mu, \; \sigma^2 \in  \Sigma^2 \}$  

Повторити дослідження для  $n=1000$. Порівняти результати, зробити висновки.

_Зауваження_. Згенеровані вибірка мають бути експортовані на диск у каталог `data`. Для послідуючого аналізу дані мають бути імпортовані з диску у середовище і сформовано `data.frame` з наступними полями:


$x_{50}$ | $x_{1000}$ | $n$
---|---|---
?|?|?  




### 2. Виконання роботи (основні моменти)

__Генеруємо вибірку за допомогою генератора випадкових чисел і записуємо дані у файл.__

```{r}
# Генерируем выборку в соответствии с заданным распределением
# (В данном случае - нормальный с параметрами "а" и "s")

# Генерируем нормальую выборку
# ВАЖНО!!!- используется аналог функции RANDOMIZE - set.seed()

set.seed(0)
a <- 0
s <- 1
n <- 100
X <- rnorm(n, a, s) #генерируем выборку
head(X)

# Запись выборки в файл
write.table(file = "data/X3.csv", X,
            row.names = FALSE,
            dec = ".",
            col.names = FALSE,
            sep = ";",
            quote = FALSE)
rm(X)
X <- read.table("data/X3.csv")
X <- as.numeric(X$V1)

# Просмотр первых и последних строк таблицы
head(X)
tail(X)

# График выборочных точек
plot(X, main = "Scatterplot", col = 4) # -> График точек

```
__Обчислюємо вибірковічислові  характеристики.__

__Зауваження__.  
__Самостійно__ написати функцію для оцінки асиметрії та ексцессу та стандартизованих значень асиметрії та ексцесу (рівень 1).  

```{r}
# Функція для обчислення асиметрії, ексцесу та їх стандартизованих значень
evaluate_distribution <- function(data) {
  n <- length(data)              # Розмір вибірки
  mean_val <- mean(data)         # Середнє значення
  sd_val <- sd(data)             # Середнє квадратичне відхилення
  
  # Асиметрія
  skewness <- sum((data - mean_val)^3) / (n * sd_val^3)
  
  # Ексцес
  kurtosis <- sum((data - mean_val)^4) / (n * sd_val^4) - 3
  
  # Стандартизована асиметрія
  std_skewness <- sqrt(n * (n - 1)) / (n - 2) * skewness
  
  # Стандартизований ексцес
  std_kurtosis <- ((n - 1) / ((n - 2) * (n - 3))) * 
                  ((n + 1) * kurtosis + 6)
  
  # Повертаємо результати у вигляді списку
  return(list(
    Skewness = skewness,
    Kurtosis = kurtosis,
    Standardized_Skewness = std_skewness,
    Standardized_Kurtosis = std_kurtosis
  ))
}

# Оцінка розподілу для вибірки X
results <- evaluate_distribution(X)

# Виведення результатів
cat("Асиметрія:", results$Skewness, "\n")
cat("Ексцес:", results$Kurtosis, "\n")
cat("Стандартизована асиметрія:", results$Standardized_Skewness, "\n")
cat("Стандартизований ексцес:", results$Standardized_Kurtosis, "\n")
```

__Самостійно__ написати функцію, що виводить у таблицю математичне сподівання, дисперсію, СКВ, оцінки асиметрії, ексцессу та стандартизованих значень асиметрії та ексцесу (рівень 2).  
```{r}
# Функція для обчислення статистичних характеристик і виведення результатів у таблицю
evaluate_distribution_table <- function(data) {
  n <- length(data)              # Розмір вибірки
  mean_val <- mean(data)         # Математичне сподівання
  var_val <- var(data)           # Дисперсія
  sd_val <- sd(data)             # Середнє квадратичне відхилення (СКВ)
  
  # Асиметрія
  skewness <- sum((data - mean_val)^3) / (n * sd_val^3)
  
  # Ексцес
  kurtosis <- sum((data - mean_val)^4) / (n * sd_val^4) - 3
  
  # Стандартизована асиметрія
  std_skewness <- sqrt(n * (n - 1)) / (n - 2) * skewness
  
  # Стандартизований ексцес
  std_kurtosis <- ((n - 1) / ((n - 2) * (n - 3))) * 
                  ((n + 1) * kurtosis + 6)
  
  # Створюємо таблицю з результатами
  result_table <- data.frame(
    Характеристика = c("Математичне сподівання", "Дисперсія", "СКВ", 
                       "Асиметрія", "Ексцес", "Стандартизована асиметрія", "Стандартизований ексцес"),
    Значення = c(mean_val, var_val, sd_val, skewness, kurtosis, std_skewness, std_kurtosis)
  )
  
  # Повертаємо таблицю
  return(result_table)
}

# Приклад використання
set.seed(0)
X <- rnorm(100, mean = 0, sd = 1)  # Генеруємо вибірку

# Оцінка статистичних характеристик та виведення таблиці
result_table <- evaluate_distribution_table(X)

# Виведення таблиці
print(result_table)
```




```{r}
summary(X)
mean(X)
sd(X)
```

```{r}
# Выводим рядом четыре основных графика
op <- par(mfrow = c(2,2)) #Сохраняем старые параметры вывода
dotchart(X, main = "Cleveland's Dot Plots", col = 4) #Точечная диаграмма Кливленда

# Ящик с усами
boxplot(X, width = 2,
        range = 1, 
        col = "gray",
        border = 4, 
        main = "Box-and-Wiskers Plot")

# Гистограмма относительных частот 
hist(X, freq = FALSE,
     breaks = nclass.Sturges(X),
     col = "grey")
curve(dnorm(x, a, s),
      col = 2, 
      lty = 2, 
      lwd = 2, 
      add = TRUE) #сверху кривая плотности
curve(dunif(x, -2, 2),
      col = 3, 
      lty = 2, 
      lwd = 2, 
      add = TRUE) #сверху кривая плотности равномерного распределения
curve(dt(x, df=10),
      col = 4,
      lty = 2,
      lwd = 2,
      add = TRUE) #сверху кривая плотности распределения СТьюдент

# Эмпирическая функция распределения F(x)
Fn <- ecdf(X)
plot(Fn,
     ylab = "",
     verticals = TRUE, 
     col.points = "blue",
     col.hor = "red",
     col.vert = "bisque",
     main = "Probability Distribution Function")
curve(pnorm(x, a, s),
      col = 6,
      lty = 1,
      lwd = 2,
      add = TRUE) # -> сверху кривая плотности

curve(pnorm(x, mean(X), sd(X)),
      col = 2,
      lty = 1,
      lwd = 2,
      add = TRUE) # -> сверху кривая плотности

# Добавляем легенду
legend("bottomright",
       pch = c(19, NA, NA),
       legend = c("Fn(x)", "F(x)","Fvol(x)"),
       lty = c(1,1,1), col = c(4,6,2), lwd = c(NA,2,2))
par(op) #Возвращаем параметры по умолчанию 
```

```{r}
# ПОСТРОЕНИЕ ГИСТОГРАММЫ: количество карманов - 20,
# по умолчанию - "Sturges", заголовок отсутсвует

table(cut(X, nclass.Sturges(X))) #Вывод интревального вариационного ряда

# Гистограмма частот 

hist(X,
     breaks = nclass.Sturges(X),
     col = "lightblue",
     main = "") #Число карманов по Стерджессу
plot(density(X))

# Гистограмма частот совместно с кривой эмпирической плотности
# (альтернативны вариаант, описанному выше) 
hist(X, 
     breaks = nclass.Sturges(X),
     freq = FALSE,
     col = "lightblue",
     xlab = "X",
     ylab = "Плотность вероятности",
     main = "Гистограмма, совмещенная с кривой плотности")
lines(density(X),
      col = "red",
      lwd = 2)
# dev.off()
```


```{r}
# Расчет пяти квантилей 
quantile(X)
```


```{r}
############### ПРОВЕРКА НА НОРМАЛЬНОСТЬ ###############

qqnorm(X, col=4)
qqline(X, col=2)

qqmath(~X) # Аналог qqnorm() из пакета LATTICE
            # (См. справку - очень большие возможности!)

# Квантиль-квантильный график для произвольного раcпределения
# в данном случае для равномерного

qqplot(qunif(ppoints(length(X)), -2, 2), X,
       main = "Q-Q plot for U(-2,2)", col=4)
qqline(X, distribution = function(p) qunif(p, -2, 2),
       prob = c(0.1, 0.6),
       col = 2)
mtext("qqline(*, dist = qunif(., -2, 2), prob = c(0.1, 0.6))")
```



```{r}
#Тест Шапиро-Уилкса 

shapiro.test(X) #ВНИМАНИЕ! Здесь  и дальше
                 # Если p > 0.05 - Нулевая гипотеза не отвергается

#Тест Колмогорова-Смирнова

ks.test(X,"pnorm") #первый вариант
ks.test(X, rnorm(length(X))) #второй вариант
```

```{r}
# Тест Андерсона-Дарлинга
# ad.test(X)

# Тест Крамера фон Мизеса
# cvm.test(X)

# Тест Колмогорова-Смирнова в модификации Лилиефорса
lillie.test(X)

# Критерий Хи-квадрат Пирсона
pearson.test(X)
pearson.test(X, n.classes=nclass.Sturges(X))
# str(pearson.test(X))

# тест Шапиро-Франсия
sf.test(X)
```

__Самостійно__ написати функцію, що виводить у таблицю значення всіх вищезазначених критеріїв та результат перевірки на нормальність (рівень 2).

```{r}
# Функція для обчислення статистичних характеристик і перевірки на нормальність
evaluate_distribution_table <- function(data) {
  n <- length(data)              # Розмір вибірки
  mean_val <- mean(data)         # Математичне сподівання
  var_val <- var(data)           # Дисперсія
  sd_val <- sd(data)             # Середнє квадратичне відхилення (СКВ)
  
  # Асиметрія
  skewness <- sum((data - mean_val)^3) / (n * sd_val^3)
  
  # Ексцес
  kurtosis <- sum((data - mean_val)^4) / (n * sd_val^4) - 3
  
  # Стандартизована асиметрія
  std_skewness <- sqrt(n * (n - 1)) / (n - 2) * skewness
  
  # Стандартизований ексцес
  std_kurtosis <- ((n - 1) / ((n - 2) * (n - 3))) * 
                  ((n + 1) * kurtosis + 6)
  
  # Перевірка на нормальність за допомогою тесту Шапіро-Уілкса
  shapiro_test <- shapiro.test(data)
  
  # Створюємо таблицю з результатами
  result_table <- data.frame(
    Характеристика = c("Математичне сподівання", "Дисперсія", "СКВ", 
                       "Асиметрія", "Ексцес", "Стандартизована асиметрія", "Стандартизований ексцес"),
    Значення = c(mean_val, var_val, sd_val, skewness, kurtosis, std_skewness, std_kurtosis)
  )
  
  # Додаємо результат тесту на нормальність
  normality_test_result <- data.frame(
    Тест = "Шапіро-Уілкса", 
    p_value = shapiro_test$p.value,
    Рішення = ifelse(shapiro_test$p.value > 0.05, "Нормальний розподіл", "Ненормальний розподіл")
  )
  
  # Повертаємо таблиці з характеристиками та результатом тесту
  return(list(характеристики = result_table, тест_нормальності = normality_test_result))
}

# Приклад використання
set.seed(0)
X <- rnorm(100, mean = 0, sd = 1)  # Генеруємо вибірку

# Оцінка статистичних характеристик та виведення таблиці
result <- evaluate_distribution_table(X)

# Виведення таблиці з характеристиками
print(result$характеристики)

# Виведення результату тесту на нормальність
print(result$тест_нормальності)
```

#Контрольні питання

__1. Які основні етапи перевірки статистичних гіпотез щодо закону розподілу, і чому це важливо для статистичного аналізу?__

Перевірка статистичних гіпотез щодо закону розподілу є важливим етапом у статистичному аналізі, оскільки допомагає визначити, чи можна використовувати певні статистичні моделі або методи для обробки даних. Основні етапи перевірки гіпотез щодо закону розподілу включають наступні кроки:
-Формулювання гіпотез
-Вибір критерію перевірки
-Визначення рівня значущості
-Проведення тесту
-Аналіз результатів

_Чому це важливо?_

--Вибір правильного статистичного методу: перевірка гіпотез щодо закону розподілу дозволяє правильно вибирати методи для подальшого аналізу, адже деякі методи, як, наприклад, параметричні тести, припускають, що дані мають певний розподіл (наприклад, нормальний).

--Оцінка надійності висновків: статистична перевірка дозволяє з високим ступенем впевненості сказати, чи можна застосовувати отримані результати для узагальнення на популяцію.

--Покращення моделювання: на основі результатів тестів можна коригувати моделі, наприклад, змінюючи розподіл або використовуючи інші техніки для аналізу.

__2. Як використовувати R для визначення нормальності розподілу даних? Які функції або тести можна використовувати для цієї мети?__

В R є кілька способів перевірки нормальності розподілу даних. Основні методи включають візуалізацію та статистичні тести. 
 Візуалізація:
 
 -Q-Q графік
 
 -Гістограма з накладеною кривою нормального розподілу
 
 Статистичні тести для нормальності:
 -Тест Шапіро-Уілкса
```{r} 
 shapiro.test(X)
```
 -Тест Колмогорова-Смирнова
```{r}
 ks.test(X, "pnorm", mean(X), sd(X))
```
-Тест Андерсона-Дарлінга
```{r}
ad.test(X)
```
-Тест Шапіро-Франція
```{r}
sf.test(X)
```
 Оцінка асиметрії та ексцесу:
 
 -Асиметрія та ексцес
```{r}
library(moments)
skewness(X) 
```
```{r}
kurtosis(X)
```

__3. Як використовувати графічні методи, такі як QQ-графік, для оцінки нормальності розподілу даних у R?__

```{r}
# Генеруємо випадкові дані з нормальним розподілом
set.seed(123)  # Для відтворюваності
X <- rnorm(100, mean = 0, sd = 1)  # 100 випадкових значень з нормальним розподілом

# Створюємо Q-Q графік
qqnorm(X, main = "Q-Q графік для перевірки нормальності")
qqline(X, col = "red")  # Додаємо червону лінію нормального розподілу
```

__4. Які можливі наслідки або дії, якщо дані не відповідають припущенню про нормальний розподіл?__

Якщо дані не відповідають припущенню про нормальний розподіл, це може знизити точність стандартних статистичних методів і вимагати використання альтернативних підходів, таких як ненормальні тести, перетворення даних, або робастні методи. Це важливо для того, щоб забезпечити надійні та коректні висновки в процесі статистичного аналізу.

